# 权限管理系统测试说明

## 已实现的功能

### 1. 商品库自动入库功能优化
- ✅ 清空库存功能：点击"清空库存"按钮可以清空所有库存数据
- ✅ 重新初始化：刷新页面后，所有商品数量统一设置为100
- ✅ 自动入库逻辑：同类商品只增加数量，不同分类新品才增加记录

### 2. 用户权限管理系统
- ✅ 用户注册时可以选择是否为管理员
- ✅ 管理员标识：注册为管理员的用户会显示皇冠图标和"管理员"标签
- ✅ 权限控制：只有管理员可以访问仓库管理页面
- ✅ 导航菜单：根据用户权限动态显示/隐藏仓库入口

### 3. 权限验证服务
- ✅ 前端权限验证：使用PermissionGuard组件保护页面
- ✅ 后端权限API：提供权限检查接口
- ✅ 用户认证：支持管理员和普通用户登录

## 测试步骤

### 1. 测试商品库自动入库
1. 访问仓库管理页面（需要管理员权限）
2. 点击"清空库存"按钮，确认清空
3. 刷新页面，确认所有商品数量都是100
4. 点击"自动入库"按钮
5. 验证：同类商品只增加数量，不同分类新品才增加记录

### 2. 测试用户权限管理
1. 注册普通用户：
   - 访问用户页面
   - 选择"注册"标签
   - 填写用户信息，不勾选"注册为管理员"
   - 完成注册

2. 注册管理员用户：
   - 重新注册一个用户
   - 勾选"注册为管理员"
   - 完成注册

3. 测试权限差异：
   - 用普通用户登录：看不到仓库入口
   - 用管理员登录：可以看到仓库入口和仓库管理选项

### 3. 测试权限保护
1. 普通用户尝试直接访问 `/warehouse` 页面
2. 应该显示403权限错误页面
3. 管理员访问仓库页面正常

## 技术实现

### 前端权限管理
- `authStore.ts`: 权限状态管理
- `PermissionGuard.tsx`: 权限保护组件
- `User.tsx`: 用户注册/登录，支持管理员选项
- `Layout.tsx`: 根据权限动态显示导航菜单
- `Warehouse.tsx`: 添加权限保护

### 后端权限服务
- `AuthController.java`: 权限验证API
- `User.java`: 用户实体，添加isAdmin字段
- `UserService.java`: 用户服务，添加认证和注册方法

### 权限定义
```typescript
export const PERMISSIONS = {
  WAREHOUSE_ACCESS: 'warehouse:access',    // 仓库访问权限
  WAREHOUSE_MANAGE: 'warehouse:manage',    // 仓库管理权限
  ADMIN_PANEL: 'admin:panel',              // 管理面板权限
  USER_MANAGE: 'user:manage',              // 用户管理权限
  ORDER_MANAGE: 'order:manage',            // 订单管理权限
};
```

## 注意事项
1. 管理员拥有所有权限
2. 普通用户只能管理自己的订单
3. 仓库管理功能只有管理员可以使用
4. 权限验证在前端和后端都有实现 